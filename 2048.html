<!DOCTYPE html>
<html>
<head>
<title>2048</title>
<style>
    body { font-family: Arial, sans-serif; background-color: #faf8ef; color: #776e65; text-align: center;}
    #game-board { width: 400px; height: 400px; background-color: #bbada0; margin: 20px auto; border-radius: 6px; position: relative; }
    .tile { width: 90px; height: 90px; position: absolute; font-size: 45px; font-weight: bold; line-height: 90px; border-radius: 3px; }
    .tile-2 { background-color: #eee4da; } .tile-4 { background-color: #ede0c8; } .tile-8 { background-color: #f2b179; color: #f9f6f2; }
    .tile-16 { background-color: #f59563; color: #f9f6f2; } .tile-32 { background-color: #f67c5f; color: #f9f6f2; }
    .tile-64 { background-color: #f65e3b; color: #f9f6f2; } .tile-128 { background-color: #edcf72; color: #f9f6f2; }
    .tile-256 { background-color: #edcc61; color: #f9f6f2; } .tile-512 { background-color: #edc850; color: #f9f6f2; }
    .tile-1024 { background-color: #edc53f; color: #f9f6f2; } .tile-2048 { background-color: #edc22e; color: #f9f6f2; }
</style>
</head>
<body>
<h1>2048</h1>
<h2 id="score">Score: 0</h2>
<div id="game-board"></div>
<script>
    const gameBoard = document.getElementById('game-board');
    const scoreDisplay = document.getElementById('score');
    let board = [];
    let score = 0;
    const size = 4;

    function startGame() {
        board = Array(size).fill(0).map(() => Array(size).fill(0));
        addNumber(); addNumber();
        updateBoard();
    }

    function updateBoard() {
        gameBoard.innerHTML = '';
        for (let r = 0; r < size; r++) {
            for (let c = 0; c < size; c++) {
                if (board[r][c] !== 0) {
                    const tile = document.createElement('div');
                    tile.className = 'tile tile-' + board[r][c];
                    tile.innerText = board[r][c];
                    tile.style.top = `${r * 100 + 10}px`;
                    tile.style.left = `${c * 100 + 10}px`;
                    gameBoard.appendChild(tile);
                }
            }
        }
        scoreDisplay.innerText = 'Score: ' + score;
    }

    function addNumber() {
        let emptyTiles = [];
        for (let r = 0; r < size; r++) for (let c = 0; c < size; c++) if (board[r][c] === 0) emptyTiles.push({r, c});
        if (emptyTiles.length > 0) {
            const {r, c} = emptyTiles[Math.floor(Math.random() * emptyTiles.length)];
            board[r][c] = Math.random() > 0.9 ? 4 : 2;
        }
    }

    document.addEventListener('keydown', e => {
        let moved = false;
        if (e.key === 'ArrowUp') moved = moveUp();
        if (e.key === 'ArrowDown') moved = moveDown();
        if (e.key === 'ArrowLeft') moved = moveLeft();
        if (e.key === 'ArrowRight') moved = moveRight();
        if (moved) { addNumber(); updateBoard(); }
    });

    function move(row) {
        let arr = row.filter(val => val);
        let missing = size - arr.length;
        let zeros = Array(missing).fill(0);
        arr = zeros.concat(arr);
        return arr;
    }

    function combine(row) {
        for (let i = size - 1; i >= 1; i--) {
            if (row[i] === row[i-1]) {
                row[i] = row[i] + row[i-1];
                score += row[i];
                row[i-1] = 0;
            }
        }
        return row;
    }

    function operate(row) {
        row = move(row);
        row = combine(row);
        row = move(row);
        return row;
    }

    function moveLeft() {
        let moved = false;
        for (let r = 0; r < size; r++) {
            const originalRow = [...board[r]];
            board[r] = operate(board[r].reverse()).reverse();
            if (JSON.stringify(originalRow) !== JSON.stringify(board[r])) moved = true;
        }
        return moved;
    }

    function moveRight() {
        let moved = false;
        for (let r = 0; r < size; r++) {
            const originalRow = [...board[r]];
            board[r] = operate(board[r]);
            if (JSON.stringify(originalRow) !== JSON.stringify(board[r])) moved = true;
        }
        return moved;
    }

    function transpose() {
        const newBoard = Array(size).fill(0).map(() => Array(size).fill(0));
        for (let r = 0; r < size; r++) for (let c = 0; c < size; c++) newBoard[c][r] = board[r][c];
        board = newBoard;
    }

    function moveUp() {
        transpose();
        const moved = moveLeft();
        transpose();
        return moved;
    }

    function moveDown() {
        transpose();
        const moved = moveRight();
        transpose();
        return moved;
    }

    startGame();
</script>
</body>
</html>